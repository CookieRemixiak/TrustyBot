const Discord = require("discord.js");
const client = new Discord.Client();
const fs = require("fs");
const config  = require("./config.json");
const colors = require("colors");
const prefix = config.prefix;
const sql = require("mysql");

/* client.once('message', message => {
    if(message.content === "<@792469472568803329>" || "<@!792469472568803329>") {
        const wzmianka = new Discord.MessageEmbed()
        .setAuthor(`Wykryto oznaczenie!`, client.user.displayAvatarURL())
        .setColor(`#ff0000`)
        .addField('Prefix: ', '\`t^\`', true)
        .addField('Ping: ', Math.round(client.ws.ping), true)
        .setThumbnail(client.user.displayAvatarURL())
        .setTimestamp()
        .setFooter(`Trusty`)
        message.channel.send(wzmianka)
    } else return;
}) */

// &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& WENHOOKI  &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&


const webohook_admi = new Discord.WebhookClient("793206793454878732", "pENZKXsUTYu65zcZRvqm495-4aKk9E3QTe0FgMqKa4S8FdYl_V9vQMz2DWRCxpXnxXMq");
const webhook_logs_join_remove = new Discord.WebhookClient("793448642546630677", "romZb8pNbA2t4v7IoLZk5IgVgDIZDDapsMRQ-wE_vzW8Oe0EvsCn2BmQisKSc5i46isN");


//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& EVENT ON MESSAGE &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&


client.on('message', async message => {
if(message.author.bot) return
if(message.content == prefix) return

if(message.author.bot) return;
if(message.content.indexOf(prefix) !== 0) return;

const args = message.content.slice(prefix.length).trim().split(/ +/g);
const cmd = args.shift().toLowerCase();


//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& KOMENDY &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&


if(cmd == 'ping' || cmd == `pong`) {
return message.channel.send("Pong: " + client.ws.ping + "ms");
}



if(cmd === `invite` || cmd == `zapro≈õ` || cmd == `zapros`){
var embed_zapro = new Discord.MessageEmbed()
.setColor("cyan")
.setAuthor(`Tworzenie zaproszenia...`, client.user.displayAvatarURL())
.setThumbnail(client.user.displayAvatarURL())
var opcja = (args[0])
if(!opcja){
    return message.channel.send(embed_zapro.addField(`Jakie zaproszenie chcesz otrzymaƒá?`, `\`t^invite bot\` lub \`t^invite serwer\``, true))
}
if(opcja == "bot"){
    return message.channel.send(embed_zapro.addField(`Wygenerowano zaproszenie do bota!`, `[Dodaj Bota](https://google.com)`, true))
}
if(opcja == "serwer"){
    return message.channel.send(embed_zapro.addField(`Wygenerowano zaproszenie do serwera!`, `[Do≈ÇƒÖcz do Serwera](https://google.com)`, true))
}
}




if(cmd === `pomoc` || cmd === `help` || cmd === `h` || cmd === `p`){
    var embed_pomoc = new Discord.MessageEmbed()
    .setAuthor(`Komendy`, client.user.displayAvatarURL())
    .setColor(`#ff0000`)
    .setThumbnail(client.user.displayAvatarURL())
    .setTimestamp()
    .setFooter(`Trusty`)
    var opcja1 = (args[0])
    if(!opcja1){
        return message.channel.send(embed_pomoc.setDescription(`\n> **Podaj kategoriƒô** \nDostƒôpne:`).addField('‚öô | Support', 'Komendy dotyczƒÖce bota!', false).addField('üõ†Ô∏è | Ustawienia', 'Tutaj skonfigurujesz kana≈Çy i wiadomo≈õci!', false).addField('üî® | Mod', 'Tutaj znajdziesz komendy moderacyjne!', false).addField('‚ÑπÔ∏è | Info', 'Przydatne do sprawdzania kont! (informacje o bocie, serwerze, u≈ºytkownik√≥w)', false))
    }
    if(opcja1 === "support"){
        return message.channel.send(embed_pomoc.setDescription(`\`\`\`Komendy Support\`\`\`\n\`‚ñ™\` invite\n\`‚ñ™\` report\n\n\`\`\` \`\`\``, false))
    }
    if(opcja1 === "ustawienia"){
        return message.channel.send(embed_pomoc.setDescription(`\`\`\`Komendy Konfiguracyjne\`\`\`\n\`‚ñ™\` ustaw\n\`‚ñ™\` config\n\n\`\`\` \`\`\``, false))
    }
    if(opcja1 === "info"){
        return message.channel.send(embed_pomoc.setDescription(`\`\`\`Komendy Informacyjne\`\`\`\n\`‚ñ™\` user\n\`‚ñ™\` serwer\n\`‚ñ™\` bot\n\`‚ñ™\` regulamin\n\n\`\`\` \`\`\``, false))
    }
    if(opcja1 === "mod"){
        return message.channel.send(embed_pomoc.setDescription(`\`\`\`Komendy Moderacyjne\`\`\`\n\`‚ñ™\` ban\n\`‚ñ™\` tempban\n\`‚ñ™\` unban\n\`‚ñ™\` kick\n\`‚ñ™\` mute\n\`‚ñ™\` tempmute\n\`‚ñ™\` unmute\n\`‚ñ™\` warn\n\`‚ñ™\` unwarn\n\`‚ñ™\` warns\n\`‚ñ™\` delete-warnings\n\`‚ñ™\` lock\n\`‚ñ™\` un-lock\n\`‚ñ™\` note\n\`‚ñ™\` un-note\n\`‚ñ™\` clear\n\n\`\`\` \`\`\``, false))
    }
}



if(cmd === `report`){

    var embed_report = new Discord.MessageEmbed()
/*
    if(message.guild.ownerID !== message.author.id){
        return message.channel.send(embed_report.setDescription(`:x: **Brak permisji!**\n*Nie posiadasz permisji* \`OWNER\``).setFooter(`Trusty ‚ñ™ B≈ÇƒÖd`).setColor(`#00ffff`))
    }
*/
    var oznaczona_osoba = message.mentions.members.first();
    if(!oznaczona_osoba){
        return message.channel.send(`:x: **Oznacz osobƒô!**\nOznacz osobƒô, kt√≥rƒÖ chcesz zg≈Çosiƒá\n\nPrzyk≈Çad: \`t^report @Remixiak pow√≥d\``)
    }
    var powod = args.slice(1).join(" ")
    if(!powod){
        return message.channel.send(`:x: **Podaj pow√≥d zg≈Çoszenia**`)
    }

    message.channel.send(`${oznaczona_osoba.user} zosta≈Ç zg≈Çoszony do administracji bota, dziƒôkujemy za zg≈Çoszenie!`);

    return webohook_admi.send(new Discord.MessageEmbed().setColor(`yellow`).setDescription(`**Zg≈Çoszenie**\n\n\`\`\`\nZg≈Çosi≈Ç: ${message.author.tag} | ${message.author.id}\nZg≈Çoszony: ${oznaczona_osoba.user.tag} | ${oznaczona_osoba.id}\n\`\`\`\n*Pow√≥d:*\n\`\`\`${powod}\n\`\`\``))

}



if(cmd === `ban` || cmd === `b`){

    if(!message.member.hasPermission(`BAN_MEMBERS`)){
        return message.channel.send(`:x: **Brak permisji!**\n*Nie posiadasz permisji* \`BAN_MEMBERS\``)
    }

    var do_bana = message.mentions.members.first() 

    if(!do_bana){
        return message.channel.send(`:x: **Brak oznaczenia**\nOznacz osobƒô, kt√≥rƒÖ chcesz zbanowaƒá\nPrzyk≈Çad: \`t^ban @Toshinori\``)
    }

    if(!do_bana.bannable || do_bana.id === message.author.id){
        return message.channel.send(`:x: **Nie mo≈ºna wykonaƒá komendy!**\nOsoba, kt√≥ra zosta≈Ça oznaczona nie jest mo≈ºliwa do zbanowania`)
    }else{

    var powodp = args.slice(1).join(" ");

    if(!powodp) return message.channel.send("Podaj pow√≥d bana!")

        try{
        do_bana.ban()    
        message.channel.send(`**Zbanowano!**\nModerator: \`${message.author.tag}\`\nZbanowany: \`${do_bana.user.tag}\`\nPow√≥d:\n\`\`\`\n${powodp}\n\`\`\``)
        do_bana.send(`Zosta≈Çe≈õ zbanowany na serwerze **\`${message.guild.name}\`**, przez **\`${message.author.tag}\`**\n\nPow√≥d:\n\`\`\`\n${powodp}\n\`\`\``)
        return;
        }catch(e){
            return message.reply("B≈ÇƒÖd podczas nadawania bana, skontaktuj siƒô z administracjƒÖ bota :|")
        }
    }
}
    

if(cmd === `kick` || cmd === `k`){
    if(!message.member.hasPermission(`KICK_MEMBERS`)){
        return message.channel.send(`:x: **Brak permisji!**\n*Nie posiadasz permisji* \`KICK_MEMBERS\``)
    }

    var do_kicka = message.mentions.members.first();
    if(!do_kicka){
        return message.channel.send(`:x: **Brak oznaczenia**\nOznacz osobƒô, kt√≥rƒÖ chcesz wyrzuciƒá\nPrzyk≈Çad: \`t^kick @Toshinori\``)
    }

    if(!do_kicka.kickable || do_kicka.id === message.author.id){
        return message.channel.send(`:x: **Nie mo≈ºna wykonaƒá komendy!**\nOsoba, kt√≥ra zosta≈Ça oznaczona nie jest mo≈ºliwa do wyrzucenia`)
    }else{

    var reason = args.slice(1).join(" ");
    if(!reason) return message.channel.send("Podaj pow√≥d wyrzucenia!")

    try{
        do_kicka.kick()
        message.channel.send(`**Wyrzucono!**\nModerator: \`${message.author.tag}\`\nWyrzucony: \`${do_kicka.user.tag}\`\nPow√≥d:\n\`\`\`\n${reason}\n\`\`\``)
        do_kicka.send(`Zosta≈Çe≈õ wyrzucony z serwera **\`${message.guild.name}\`**, przez **\`${message.author.tag}\`**\n\nPow√≥d:\n\`\`\`\n${reason}\n\`\`\``)
        return;
        }catch(e){
            return message.reply("B≈ÇƒÖd podczas nadawania bana, skontaktuj siƒô z administracjƒÖ bota :|")
        }
    }
}



if(cmd === `serwer` || cmd === "server" || cmd === "serwer-info"){

    var owner = message.guild.ownerID
    var sz = message.guild.members.cache.find(u => u.id === owner);
    if(!sz){
      sz = "Brak danych";
    }  
      var boty = message.guild.members.cache.filter(member => member.user.bot).size;
      var serwus = message.guild.createdAt
      var serwerEmbed = new Discord.MessageEmbed()       
          .setColor("cyan")
          .setThumbnail(message.guild.iconURL())
          .setAuthor(`Informacje o Serwerze`, client.user.displayAvatarURL())
          .addField(` **Nazwa:**`, `\`${message.guild.name}\``)
          .addField(` **ID:**`, `\`${message.guild.id}\``)
          .addField(` **W≈Ça≈õciciel:**`, `${sz}`, true)
          .addField(` **U≈ºytkownicy:**`, `\`${message.guild.memberCount}\``, true)
          .addField(` **Boty:**`, `\`${boty}\``, true)
          .addField(` **Online:**`, `\`${message.guild.members.cache.filter(member => member.presence.status === "online").size}\``, true)
          .addField(` **Zajƒôtych:**`, `\`${message.guild.members.cache.filter(member => member.presence.status === "dnd").size}\``, true)
          .addField(` **Offline:**`, `\`${message.guild.members.cache.filter(member => member.presence.status === "offline").size}\``, true)
          .addField(` **Role:**`, `\`${message.guild.roles.cache.size}\``, true)
          .addField(` **Najwy≈ºsza:**`, `${message.guild.roles.highest}`, true)
          .addField(` **Emoji:**`, `\`${message.guild.emojis.cache.size}\``, true)
          .addField(` **Utworzono:**`, `\`${
    
    serwus.getDate().toString().padStart(2, '0')}.${
    (serwus.getMonth()+1).toString().padStart(2, '0')}.${
    serwus.getFullYear().toString().padStart(4, '0')}\` **| Godzina:** \`${
    serwus.getHours().toString().padStart(2, '0')}:${
    serwus.getMinutes().toString().padStart(2, '0')}:${
      serwus.getSeconds().toString().padStart(2, '0')}\` `)
      .setFooter(`Trusty`, client.user.displayAvatarURL());
         message.channel.send(serwerEmbed);
}



if(cmd === "user" || cmd === "user-info" || cmd === "info"){

  var stat = {
    online: `Online`,
    dnd: `Nie przeszkadzaƒá`,
    idle: `Zajƒôty`,
    offline: `Offline`
}

var status = {
    online: `<:ONLINE:793462116811800596> `,
    dnd: `<:DND:793462116190781440>`,
    idle: `<:IDLE:793462116421599282>`,
    offline: `<:OFFLINE:793462116480450570>`
}


let mentioneduserinfo = message.mentions.members.first() //oznaczony
if (!mentioneduserinfo) {
    var dt = message.author.createdAt //autor stworzy≈Ç
    var dol = message.member.joinedAt //autor doi≈ÇƒÖczy≈Ç

    let uEmbed = new Discord.MessageEmbed()
        .setColor("#000000")
        .setThumbnail(message.author.displayAvatarURL())
        .addField(`**Nazwa:**`, `\`${message.author.username}\``, true)
        .addField(`**Tag:**`, `\`#${message.author.discriminator}\``, true)
        .addField(`**ID:**`, `\`${message.author.id}\``)
        .addField(`**Status:**`, `${status[message.author.presence.status]} ${stat[message.author.presence.status]}`)
        .addField(`**Utworzono:**`, `\`${


dt.getDate().toString().padStart(2, '0')}.${
(dt.getMonth()+1).toString().padStart(2, '0')}.${
dt.getFullYear().toString().padStart(4, '0')}\` **| Godzina:** \`${
dt.getHours().toString().padStart(2, '0')}:${
dt.getMinutes().toString().padStart(2, '0')}:${
dt.getSeconds().toString().padStart(2, '0')}\``)




    .addField(`**Do≈ÇƒÖczy≈Ç:**`, `\`${
dol.getDate().toString().padStart(2, '0')}.${
(dol.getMonth()+1).toString().padStart(2, '0')}.${
dol.getFullYear().toString().padStart(4, '0')}\` **| Godzina:** \`${
dol.getHours().toString().padStart(2, '0')}:${
dol.getMinutes().toString().padStart(2, '0')}:${
  dol.getSeconds().toString().padStart(2, '0')}\``)




    .addField(`**Gra w: **`, `\`${message.author.presence.activities.join(" \`‚Ä¢\` ")}` || `\`W nic nie gra\``)
        .setFooter(`Trusty`, client.user.displayAvatarURL());
    message.channel.send(uEmbed);


    return


} else {
    var lod = mentioneduserinfo.joinedAt
    var lud = mentioneduserinfo.user.createdAt

    let okims = new Discord.MessageEmbed()
        .setColor("#000000")
        .setThumbnail(mentioneduserinfo.user.displayAvatarURL())
        .addField(`**Nazwa:**`, `\`${mentioneduserinfo.user.tag}\``, true)
        .addField(`**Tag:**`, `\`#${mentioneduserinfo.user.discriminator}\``, true)
        .addField(`**ID:**`, `\`${mentioneduserinfo.id}\``)
        .addField(`**Status:**`, `${stat[mentioneduserinfo.presence.status]}`)
        .addField(`**Utworzono:**`, `\`${
            lud.getDate().toString().padStart(2, '0')}.${
           (lud.getMonth()+1).toString().padStart(2, '0')}.${
            lud.getFullYear().toString().padStart(4, '0')}\` **| Godzina:** \`${
            lud.getHours().toString().padStart(2, '0')}:${
            lud.getMinutes().toString().padStart(2, '0')}:${
            lud.getSeconds().toString().padStart(2, '0')}\``) 
        .addField(`**Do≈ÇƒÖczy≈Ç:**`, `\`${
            lod.getDate().toString().padStart(2, '0')}.${
            (lod.getMonth()+1).toString().padStart(2, '0')}.${
            lod.getFullYear().toString().padStart(4, '0')}\` **| Godzina:** \`${
            lod.getHours().toString().padStart(2, '0')}:${
            lod.getMinutes().toString().padStart(2, '0')}:${
            lod.getSeconds().toString().padStart(2, '0')}\``)
        .addField(`**Gra w: **`, `${mentioneduserinfo.presence.activities.join(" \`‚Ä¢\` ")}` || `\`W nic nie gra\``, true)
        .setFooter(`Trusty`, client.user.displayAvatarURL());

         message.channel.send(okims);
         return
}
}



if(cmd === "clear" || cmd === "purge" || cmd === "c"){
    if(!message.member.hasPermission(`MANAGE_CHANNELS`)){
        return message.channel.send(`:x: **Brak permisji!**\n*Nie posiadasz permisji* \`MANAGE_CHANNELS\``);
    }
    var ile_wiad = parseInt(args[0])
    if(!ile_wiad){
        return message.channel.send(`Podaj ilƒô wiadomo≈õci mam usunƒÖƒá \`max. 200\`\n*Przyk≈Çad:* \`t^clear 20\``);
    }
    if(ile_wiad > 100){
        return message.channel.send("Nie mo≈ºna usunƒÖƒá wiƒôcej ni≈º 100 wiadomo≈õci na raz");
    }
    try{
    message.channel.bulkDelete(ile_wiad);
    message.reply(`Wiadomo≈õci zosta≈Çy usuniƒôte!`);
    return;
    }catch(e){
        return message.channel.send("B≈ÇƒÖd...")
    }
}

if(cmd === "join"){
    client.emit('guildMemberAdd', message.member)
}






   
});


//&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&  LOGOWANIE  &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

client.on('ready', () => {
    console.log(`${client.user.tag}`.yellow + ` ‚Ä¢ ${client.user.id}`.cyan +  ` - Online ‚Ä¢ ${client.ws.ping} ms`.green)
    client.user.setActivity("@Trusty | t^pomoc");
});

client.on('guildMemberAdd', async member => {
    let antiosoby = ['542378004094124033', '732673714994544810', '737664846245527603', '647194026935582761']
    const channel = client.channels.cache.get(`793206769441570856`)
    if(antiosoby.includes(member.id)){
        const uwaga = new Discord.MessageEmbed().setTitle(`Uwaga! Niebezpieczna osoba.`).setColor('#FF0000').addField(`Nick:`, `${member.user.tag}`, true).addField(`ID:`, `${member.id}`, true).addField(`Ping:`, `<@${member.id}>`, false)
        channel.send(uwaga)
    } else return;
});

client.on('guildCreate', async guild => {
    webhook_logs_join_remove.send(new Discord.MessageEmbed().setColor("#66ff00").setDescription(`Bot do≈ÇƒÖczy≈Ç na serwer!\n\nNazwa: ${guild.name}\nID: ${guild.id}\n\nW≈Ça≈õciciel: ${guild.owner.user}\nID: ${guild.ownerID}\n\nU≈ºytkownicy: + ${guild.memberCount}`))
});
client.on(`guildDelete`, async guild_leave => {
    webhook_logs_join_remove.send(new Discord.MessageEmbed().setColor("#ff0000").setDescription(`Bot opu≈õci≈Ç serwer!\n\nNazwa: ${guild_leave.name}\nID: ${guild.id}\n\nW≈Ça≈õciciel: ${guild_leave.owner.user}\nID: ${guild_leave.ownerID}\n\nU≈ºytkownicy: -${guild_leave.memberCount}`))
})
client.on('guildBanAdd', async (guild, user) => {
     
});
client.on('message', async (message_check) => {
    
});
client.login(config.token)

